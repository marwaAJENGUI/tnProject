<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" 
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="template/#{signInController.template}.xhtml">

		<h:head>
			<meta charset="utf-8" />
			<meta http-equiv="X-UA-Compatible" content="IE=edge" />
			<meta name="viewport" content="width=device-width, initial-scale=1" />
			<title>Products</title>
		</h:head>
<ui:param name="page_name" value="Consomi TN !"/>
		<ui:define name="products">
		


<f:view>
<br/>	<br/>
<div align="center">		
<p:panel  style="width:90%; ">
<c:choose>
	<c:when  test="#{signInController.isAdmin eq true}">
		<h:panelGroup >
		<h2>Product Form</h2>
		<br/>
		<div align="center" style="width:100%;">
		<div align="left" style="float:left" >
		<p:growl/><p:growl/><p:growl/><p:growl/><p:growl/>
			<h:form id="Product" >
				<p:panelGrid id="product"  >	
						<p:watermark for="barCode" value="BarCode "/>
						<p:inputText id="barCode" value="#{productJSFController.product.barCode}">
							<f:param name="fileName" value="#{productJSFController.product.barCode}" />
							<f:validateBean/>  		
						</p:inputText>
						<p:message for="barCode" />
					
					
						<p:watermark for="name"  value="Name"/>
						<p:inputText id="name" value="#{productJSFController.product.name}" required="true">
							<f:validateBean/>  		
						</p:inputText>
						<p:message for="name" />
					
					
						<p:watermark for="price"  value="Price"/>
						<p:inputText id="price" value="#{productJSFController.product.price}">
						</p:inputText>
						<p:message for="price" />
					
					
						<p:selectOneMenu  id="category" value="#{productJSFController.categoryId}" required="true">
							<f:validateBean/>  		
							<f:selectItem itemLabel="Select a category" itemValue="" />
							<f:selectItems  value="#{productCategoryJSFController.categories}" var="cat" itemLabel="#{cat.name}" itemValue="#{cat.id}"   />
						</p:selectOneMenu>
						<p:message for="category" />
					<p:commandButton value="Add" action="#{productJSFController.addProduct()}" ajax="false"  mode="simple" skinSimple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"  />
					<p:commandButton action="#{productJSFController.updateProduct()}" value="Edit" ajax="false"  update=":product"/>			
			</p:panelGrid>			
		</h:form>
		<p:lightBox iframe="true" id="lighbox3">
		    <h:outputLink value="testFile?fileName=#{productJSFController.product.barCode}" title="barCode=#{productJSFController.product.barCode}">
		        <h:outputText value="Set Product Image" />
		        <f:facet name="inline">
		          		<h:outputText value="Set image for product with barCode:#{productJSFController.product.barCode}" />
		    	</f:facet>        
		    </h:outputLink>
		</p:lightBox>
									
		</div>
		<div style=" text-align: left">
		<h:form  enctype="multipart/form-data">  
			<p:outputLabel for="barCodeImage" value="Set BarCode from Image:" />
			<p:fileUpload  id="barCodeImage" update="message" value="#{productJSFController.file}" mode="simple" skinSimple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
			<p:commandButton value="Submit" ajax="false" action="#{productJSFController.upload}" disabled="false" />
			<p:growl id="message" />	
		</h:form>
		<br/><br/><br/><br/><br/><br/><br/>
		</div>
		
		</div>
		</h:panelGroup>
		<br></br>
	</c:when>
</c:choose>

<h:panelGroup>
<h2>Products List</h2>

<h:form id="productList">
	<p:panelGrid columns="5">
	    <h:outputText value="Product Name:" />
		<p:inputText value="#{productJSFController.productName}"/>
		<h:outputText value="Category Name:"/>
		<p:inputText value="#{productJSFController.categoryName}"/>
		<p:commandButton action="#{productJSFController.searchProducts()}" value="Search" />
	</p:panelGrid>
</h:form>
<br/>

<h:form>
	<p:dataTable value="#{productJSFController.products}" var="product" border="1">
		<p:column headerText="Image" >
			<f:facet name="header">
				<h:outputText value="Image" />
			</f:facet>
			<p:graphicImage value="#{productJSFController.productImage}"  style = "width:150px;height:130px">
				<f:param name="pid" value="#{product.barCode}" />
			</p:graphicImage>
		</p:column>
		<p:column>
			<f:facet name="header">
				<h:outputText value="BarCode" />
			</f:facet>
		 	<p:link outcome="#{productJSFController.echoProduct()}" value="#{product.barCode}">
				<f:param name="barCode" value="#{product.barCode}"/>
				<f:param name="categoryId" value="#{product.category.id}"/>
			</p:link>
		</p:column>
		<p:column>
			<f:facet name="header">
				<h:outputText value="Name" />
			</f:facet>
			<p:link outcome="#{productJSFController.echoProduct()}" value="#{product.name}">
				<f:param name="barCode" value="#{product.barCode}"/>
				<f:param name="categoryId" value="#{product.category.id}"/>
			</p:link>
		</p:column>
		<p:column>
			<f:facet name="header">
				<h:outputText value="Price" />
			</f:facet>
			<h:outputText value="#{product.price}" /> 
		</p:column>
		<p:column>
			<f:facet name="header">
				<h:outputText value="Category"/>
			</f:facet>
			<p:link outcome="#{productJSFController.echoCategory()}" value="#{product.category.name}">
				<f:param name="categoryId" value="#{product.category.id}"/>
			</p:link>
		</p:column>
		<c:choose>
			<c:when  test="#{signInController.isAdmin eq true}">
				 <p:column>
					<f:facet name="header">
						<h:outputText value="Action" />
					</f:facet>
				 	<p:commandButton action="#{productJSFController.removeProduct(product)}" value="Remove" />
					<p:commandButton action="#{productJSFController.editProduct(product)}" value="Edit" />
				</p:column>
			</c:when>
		</c:choose>
			
		
	</p:dataTable>

</h:form>
</h:panelGroup>

</p:panel>
</div>
</f:view>
</ui:define>
</ui:composition>